-- -------------------------------------------------------------
-- 
-- File Name: C:\ultrazohm_sw\ip_cores\FCS_MPC_3Phase_SPMSM\hdlsrc\FCS_MPC_3Phase_SPMSM_TEST1\FCS_MPC_3Phase_SPMSM_IP_Core_src_MATLAB_Function1.vhd
-- Created: 2022-06-27 11:28:55
-- 
-- Generated by MATLAB 9.12 and HDL Coder 3.20
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: FCS_MPC_3Phase_SPMSM_IP_Core_src_MATLAB_Function1
-- Source Path: FCS_MPC_3Phase_SPMSM_TEST1/Microcontroller Software/Subsystem1/MATLAB Function1
-- Hierarchy Level: 1
-- 
-- Ermittlung des Indizes des minimums des Cost-Function-Vektors
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;
USE work.FCS_MPC_3Phase_SPMSM_IP_Core_src_Subsystem1_pkg.ALL;

ENTITY FCS_MPC_3Phase_SPMSM_IP_Core_src_MATLAB_Function1 IS
  PORT( J                                 :   IN    vector_of_std_logic_vector64(0 TO 7);  -- double [8]
        v                                 :   IN    matrix_of_std_logic_vector32(0 TO 1, 0 TO 7);  -- single [2x8]
        I                                 :   OUT   std_logic_vector(63 DOWNTO 0);  -- double
        v_opt                             :   OUT   vector_of_std_logic_vector64(0 TO 1)  -- double [2]
        );
END FCS_MPC_3Phase_SPMSM_IP_Core_src_MATLAB_Function1;


ARCHITECTURE rtl OF FCS_MPC_3Phase_SPMSM_IP_Core_src_MATLAB_Function1 IS

  -- Component Declarations
  COMPONENT FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_relop_double
    PORT( nfp_in1                         :   IN    std_logic_vector(63 DOWNTO 0);  -- double
          nfp_in2                         :   IN    std_logic_vector(63 DOWNTO 0);  -- double
          nfp_out1                        :   OUT   std_logic
          );
  END COMPONENT;

  COMPONENT FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_convert_double_to_fixed_8_En0
    PORT( nfp_in                          :   IN    std_logic_vector(63 DOWNTO 0);  -- double
          nfp_out                         :   OUT   std_logic_vector(7 DOWNTO 0)  -- uint8
          );
  END COMPONENT;

  COMPONENT FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_convert_single2double
    PORT( nfp_in                          :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          nfp_out                         :   OUT   std_logic_vector(63 DOWNTO 0)  -- double
          );
  END COMPONENT;

  -- Component Configuration Statements
  FOR ALL : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_relop_double
    USE ENTITY work.FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_relop_double(rtl);

  FOR ALL : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_convert_double_to_fixed_8_En0
    USE ENTITY work.FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_convert_double_to_fixed_8_En0(rtl);

  FOR ALL : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_convert_single2double
    USE ENTITY work.FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_convert_single2double(rtl);

  -- Signals
  SIGNAL out0                             : std_logic;
  SIGNAL J_0                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL J_1                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL min                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL out0_1                           : std_logic;
  SIGNAL J_2                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL min_1                            : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL out0_2                           : std_logic;
  SIGNAL J_3                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL min_2                            : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL out0_3                           : std_logic;
  SIGNAL J_4                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL min_3                            : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL out0_4                           : std_logic;
  SIGNAL J_5                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL min_4                            : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL out0_5                           : std_logic;
  SIGNAL J_6                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL min_5                            : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL out0_6                           : std_logic;
  SIGNAL I_1                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_2                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_3                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_4                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_5                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_6                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_7                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_8                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_9                              : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_10                             : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_11                             : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_12                             : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_13                             : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_14                             : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL I_15                             : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL Selector_dtc_comp_dtc_comp_out   : std_logic_vector(7 DOWNTO 0);  -- ufix8
  SIGNAL Selector_dtc_comp_dtc_comp_out_unsigned : unsigned(7 DOWNTO 0);  -- uint8
  SIGNAL Selector_dtc_comp_dtc_comp_out_1 : std_logic_vector(7 DOWNTO 0);  -- ufix8
  SIGNAL Selector_dtc_comp_dtc_comp_out_unsigned_1 : unsigned(7 DOWNTO 0);  -- uint8
  SIGNAL v_opt_1                          : vector_of_std_logic_vector64(0 TO 1);  -- ufix64 [2]
  SIGNAL Out_1                            : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL out0_7                           : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL v_opt_2                          : vector_of_std_logic_vector64(0 TO 1);  -- ufix64 [2]
  SIGNAL Out_1_1                          : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL out0_8                           : std_logic_vector(63 DOWNTO 0);  -- ufix64
  SIGNAL v_opt_3                          : vector_of_std_logic_vector64(0 TO 1);  -- ufix64 [2]

BEGIN
  u_nfp_relop_comp : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_relop_double
    PORT MAP( nfp_in1 => J(1),  -- double
              nfp_in2 => J(0),  -- double
              nfp_out1 => out0
              );

  u_nfp_relop_comp_1 : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_relop_double
    PORT MAP( nfp_in1 => J(2),  -- double
              nfp_in2 => min,  -- double
              nfp_out1 => out0_1
              );

  u_nfp_relop_comp_2 : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_relop_double
    PORT MAP( nfp_in1 => J(3),  -- double
              nfp_in2 => min_1,  -- double
              nfp_out1 => out0_2
              );

  u_nfp_relop_comp_3 : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_relop_double
    PORT MAP( nfp_in1 => J(4),  -- double
              nfp_in2 => min_2,  -- double
              nfp_out1 => out0_3
              );

  u_nfp_relop_comp_4 : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_relop_double
    PORT MAP( nfp_in1 => J(5),  -- double
              nfp_in2 => min_3,  -- double
              nfp_out1 => out0_4
              );

  u_nfp_relop_comp_5 : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_relop_double
    PORT MAP( nfp_in1 => J(6),  -- double
              nfp_in2 => min_4,  -- double
              nfp_out1 => out0_5
              );

  u_nfp_relop_comp_6 : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_relop_double
    PORT MAP( nfp_in1 => J(7),  -- double
              nfp_in2 => min_5,  -- double
              nfp_out1 => out0_6
              );

  -- Ausgabe der ermittelten Spannungen (alpha/beta) vk
  u_FCS_MPC_3Phase_SPMSM_TEST1_Microcontroller_Software_Subsystem1_MATLAB_Function1_nfp_convert_double_to_fixed_8_En0 : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_convert_double_to_fixed_8_En0
    PORT MAP( nfp_in => I_15,  -- double
              nfp_out => Selector_dtc_comp_dtc_comp_out  -- uint8
              );

  u_FCS_MPC_3Phase_SPMSM_TEST1_Microcontroller_Software_Subsystem1_MATLAB_Function1_nfp_convert_double_to_fixed_8_En0_1 : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_convert_double_to_fixed_8_En0
    PORT MAP( nfp_in => I_15,  -- double
              nfp_out => Selector_dtc_comp_dtc_comp_out_1  -- uint8
              );

  u_FCS_MPC_3Phase_SPMSM_TEST1_Microcontroller_Software_Subsystem1_MATLAB_Function_nfp_convert_single2double : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_convert_single2double
    PORT MAP( nfp_in => Out_1,  -- single
              nfp_out => out0_7  -- double
              );

  u_FCS_MPC_3Phase_SPMSM_TEST1_Microcontroller_Software_Subsystem1_MATLAB_Function_nfp_convert_single2double_1 : FCS_MPC_3Phase_SPMSM_IP_Core_src_nfp_convert_single2double
    PORT MAP( nfp_in => Out_1_1,  -- single
              nfp_out => out0_8  -- double
              );

  J_0 <= J(0);

  J_1 <= J(1);

  
  min <= J_0 WHEN out0 = '0' ELSE
      J_1;

  J_2 <= J(2);

  
  min_1 <= min WHEN out0_1 = '0' ELSE
      J_2;

  J_3 <= J(3);

  
  min_2 <= min_1 WHEN out0_2 = '0' ELSE
      J_3;

  J_4 <= J(4);

  
  min_3 <= min_2 WHEN out0_3 = '0' ELSE
      J_4;

  J_5 <= J(5);

  
  min_4 <= min_3 WHEN out0_4 = '0' ELSE
      J_5;

  J_6 <= J(6);

  
  min_5 <= min_4 WHEN out0_5 = '0' ELSE
      J_6;

  I_1 <= X"3ff0000000000000";

  I_2 <= X"4000000000000000";

  
  I_3 <= I_1 WHEN out0 = '0' ELSE
      I_2;

  I_4 <= X"4008000000000000";

  
  I_5 <= I_3 WHEN out0_1 = '0' ELSE
      I_4;

  I_6 <= X"4010000000000000";

  
  I_7 <= I_5 WHEN out0_2 = '0' ELSE
      I_6;

  I_8 <= X"4014000000000000";

  
  I_9 <= I_7 WHEN out0_3 = '0' ELSE
      I_8;

  I_10 <= X"4018000000000000";

  
  I_11 <= I_9 WHEN out0_4 = '0' ELSE
      I_10;

  I_12 <= X"401c000000000000";

  
  I_13 <= I_11 WHEN out0_5 = '0' ELSE
      I_12;

  I_14 <= X"4020000000000000";

  
  I_15 <= I_13 WHEN out0_6 = '0' ELSE
      I_14;

  Selector_dtc_comp_dtc_comp_out_unsigned <= unsigned(Selector_dtc_comp_dtc_comp_out);

  Selector_dtc_comp_dtc_comp_out_unsigned_1 <= unsigned(Selector_dtc_comp_dtc_comp_out_1);

  v_opt_1(0) <= X"0000000000000000";
  v_opt_1(1) <= X"0000000000000000";

  -- Ausgabe der ermittelten Spannungen (alpha/beta) vk
  Selector6_output : PROCESS (Selector_dtc_comp_dtc_comp_out_unsigned, v)
  BEGIN
    Out_1 <= v(0, 7);
    IF Selector_dtc_comp_dtc_comp_out_unsigned = to_unsigned(16#07#, 8) THEN 
      Out_1 <= v(0, 6);
    END IF;
    IF Selector_dtc_comp_dtc_comp_out_unsigned = to_unsigned(16#06#, 8) THEN 
      Out_1 <= v(0, 5);
    END IF;
    IF Selector_dtc_comp_dtc_comp_out_unsigned = to_unsigned(16#05#, 8) THEN 
      Out_1 <= v(0, 4);
    END IF;
    IF Selector_dtc_comp_dtc_comp_out_unsigned = to_unsigned(16#04#, 8) THEN 
      Out_1 <= v(0, 3);
    END IF;
    IF Selector_dtc_comp_dtc_comp_out_unsigned = to_unsigned(16#03#, 8) THEN 
      Out_1 <= v(0, 2);
    END IF;
    IF Selector_dtc_comp_dtc_comp_out_unsigned = to_unsigned(16#02#, 8) THEN 
      Out_1 <= v(0, 1);
    END IF;
    IF Selector_dtc_comp_dtc_comp_out_unsigned = to_unsigned(16#01#, 8) THEN 
      Out_1 <= v(0, 0);
    END IF;
  END PROCESS Selector6_output;


  v_opt_2(0) <= out0_7;
  v_opt_2(1) <= v_opt_1(1);

  Selector3_output : PROCESS (Selector_dtc_comp_dtc_comp_out_unsigned_1, v)
  BEGIN
    Out_1_1 <= v(1, 7);
    IF Selector_dtc_comp_dtc_comp_out_unsigned_1 = to_unsigned(16#07#, 8) THEN 
      Out_1_1 <= v(1, 6);
    END IF;
    IF Selector_dtc_comp_dtc_comp_out_unsigned_1 = to_unsigned(16#06#, 8) THEN 
      Out_1_1 <= v(1, 5);
    END IF;
    IF Selector_dtc_comp_dtc_comp_out_unsigned_1 = to_unsigned(16#05#, 8) THEN 
      Out_1_1 <= v(1, 4);
    END IF;
    IF Selector_dtc_comp_dtc_comp_out_unsigned_1 = to_unsigned(16#04#, 8) THEN 
      Out_1_1 <= v(1, 3);
    END IF;
    IF Selector_dtc_comp_dtc_comp_out_unsigned_1 = to_unsigned(16#03#, 8) THEN 
      Out_1_1 <= v(1, 2);
    END IF;
    IF Selector_dtc_comp_dtc_comp_out_unsigned_1 = to_unsigned(16#02#, 8) THEN 
      Out_1_1 <= v(1, 1);
    END IF;
    IF Selector_dtc_comp_dtc_comp_out_unsigned_1 = to_unsigned(16#01#, 8) THEN 
      Out_1_1 <= v(1, 0);
    END IF;
  END PROCESS Selector3_output;


  v_opt_3(0) <= v_opt_2(0);
  v_opt_3(1) <= out0_8;

  v_opt <= v_opt_3;

  I <= I_15;

END rtl;

