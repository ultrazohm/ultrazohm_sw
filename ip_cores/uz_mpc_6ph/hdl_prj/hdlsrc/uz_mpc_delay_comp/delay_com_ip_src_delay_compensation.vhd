-- -------------------------------------------------------------
-- 
-- File Name: hdl_prj\hdlsrc\uz_mpc_delay_comp\delay_com_ip_src_delay_compensation.vhd
-- Created: 2022-08-23 18:41:50
-- 
-- Generated by MATLAB 9.10 and HDL Coder 3.18
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: delay_com_ip_src_delay_compensation
-- Source Path: uz_mpc_delay_comp/delay_comp/delay_compensation
-- Hierarchy Level: 1
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;

ENTITY delay_com_ip_src_delay_compensation IS
  PORT( vd_pu                             :   IN    std_logic_vector(26 DOWNTO 0);  -- sfix27_En24
        vq_pu                             :   IN    std_logic_vector(26 DOWNTO 0);  -- sfix27_En24
        vx_pu                             :   IN    std_logic_vector(26 DOWNTO 0);  -- sfix27_En24
        vy_pu                             :   IN    std_logic_vector(26 DOWNTO 0);  -- sfix27_En24
        id_k_pu                           :   IN    std_logic_vector(26 DOWNTO 0);  -- sfix27_En16
        iq_k_pu                           :   IN    std_logic_vector(26 DOWNTO 0);  -- sfix27_En16
        ix_k_pu                           :   IN    std_logic_vector(17 DOWNTO 0);  -- sfix18_En11
        iy_k_pu                           :   IN    std_logic_vector(17 DOWNTO 0);  -- sfix18_En11
        omega_m_pu                        :   IN    std_logic_vector(17 DOWNTO 0);  -- sfix18_En15
        Ts_times_ZB_over_Ld               :   IN    std_logic_vector(17 DOWNTO 0);  -- sfix18_En15
        Ts_times_ZB_over_Lq               :   IN    std_logic_vector(17 DOWNTO 0);  -- sfix18_En15
        Ts_times_ZB_over_Lx               :   IN    std_logic_vector(17 DOWNTO 0);  -- sfix18_En15
        Ts_times_ZB_over_Ly               :   IN    std_logic_vector(17 DOWNTO 0);  -- sfix18_En15
        Rs_over_ZB                        :   IN    std_logic_vector(17 DOWNTO 0);  -- sfix18_En15
        Ld_over_LB                        :   IN    std_logic_vector(17 DOWNTO 0);  -- sfix18_En15
        Lq_over_LB                        :   IN    std_logic_vector(17 DOWNTO 0);  -- sfix18_En15
        psi_pm_over_psiB                  :   IN    std_logic_vector(17 DOWNTO 0);  -- sfix18_En15
        polepairs                         :   IN    std_logic_vector(31 DOWNTO 0);  -- uint32
        id_delay_pu                       :   OUT   std_logic_vector(26 DOWNTO 0);  -- sfix27_En24
        iq_delay_pu                       :   OUT   std_logic_vector(26 DOWNTO 0);  -- sfix27_En24
        ix_delay_pu                       :   OUT   std_logic_vector(26 DOWNTO 0);  -- sfix27_En24
        iy_delay_pu                       :   OUT   std_logic_vector(26 DOWNTO 0)  -- sfix27_En24
        );
END delay_com_ip_src_delay_compensation;


ARCHITECTURE rtl OF delay_com_ip_src_delay_compensation IS

  -- Signals
  SIGNAL vd_pu_signed                     : signed(26 DOWNTO 0);  -- sfix27_En24
  SIGNAL vq_pu_signed                     : signed(26 DOWNTO 0);  -- sfix27_En24
  SIGNAL vx_pu_signed                     : signed(26 DOWNTO 0);  -- sfix27_En24
  SIGNAL vy_pu_signed                     : signed(26 DOWNTO 0);  -- sfix27_En24
  SIGNAL id_k_pu_signed                   : signed(26 DOWNTO 0);  -- sfix27_En16
  SIGNAL iq_k_pu_signed                   : signed(26 DOWNTO 0);  -- sfix27_En16
  SIGNAL ix_k_pu_signed                   : signed(17 DOWNTO 0);  -- sfix18_En11
  SIGNAL iy_k_pu_signed                   : signed(17 DOWNTO 0);  -- sfix18_En11
  SIGNAL omega_m_pu_signed                : signed(17 DOWNTO 0);  -- sfix18_En15
  SIGNAL Ts_times_ZB_over_Ld_signed       : signed(17 DOWNTO 0);  -- sfix18_En15
  SIGNAL Ts_times_ZB_over_Lq_signed       : signed(17 DOWNTO 0);  -- sfix18_En15
  SIGNAL Ts_times_ZB_over_Lx_signed       : signed(17 DOWNTO 0);  -- sfix18_En15
  SIGNAL Ts_times_ZB_over_Ly_signed       : signed(17 DOWNTO 0);  -- sfix18_En15
  SIGNAL Rs_over_ZB_signed                : signed(17 DOWNTO 0);  -- sfix18_En15
  SIGNAL Ld_over_LB_signed                : signed(17 DOWNTO 0);  -- sfix18_En15
  SIGNAL Lq_over_LB_signed                : signed(17 DOWNTO 0);  -- sfix18_En15
  SIGNAL psi_pm_over_psiB_signed          : signed(17 DOWNTO 0);  -- sfix18_En15
  SIGNAL polepairs_unsigned               : unsigned(31 DOWNTO 0);  -- uint32
  SIGNAL id_delay_pu_tmp                  : signed(26 DOWNTO 0);  -- sfix27_En24
  SIGNAL iq_delay_pu_tmp                  : signed(26 DOWNTO 0);  -- sfix27_En24
  SIGNAL ix_delay_pu_tmp                  : signed(26 DOWNTO 0);  -- sfix27_En24
  SIGNAL iy_delay_pu_tmp                  : signed(26 DOWNTO 0);  -- sfix27_En24
  SIGNAL ix_k_pu_1                        : signed(26 DOWNTO 0);  -- sfix18_En11
  SIGNAL iy_k_pu_1                        : signed(26 DOWNTO 0);  -- sfix18_En11
  SIGNAL polepairs_1                      : unsigned(17 DOWNTO 0);  -- uint32
  SIGNAL sub_cast                         : signed(45 DOWNTO 0);  -- sfix46_En31
  SIGNAL mul_temp                         : signed(44 DOWNTO 0);  -- sfix45_En31
  SIGNAL sub_cast_1                       : signed(45 DOWNTO 0);  -- sfix46_En31
  SIGNAL sub_temp                         : signed(45 DOWNTO 0);  -- sfix46_En31
  SIGNAL add_cast                         : signed(81 DOWNTO 0);  -- sfix82_En46
  SIGNAL mul_temp_1                       : signed(44 DOWNTO 0);  -- sfix45_En31
  SIGNAL mul_temp_2                       : signed(62 DOWNTO 0);  -- sfix63_En46
  SIGNAL cast                             : signed(18 DOWNTO 0);  -- sfix19
  SIGNAL mul_temp_3                       : signed(81 DOWNTO 0);  -- sfix82_En46
  SIGNAL add_cast_1                       : signed(80 DOWNTO 0);  -- sfix81_En46
  SIGNAL add_cast_2                       : signed(81 DOWNTO 0);  -- sfix82_En46
  SIGNAL add_temp                         : signed(81 DOWNTO 0);  -- sfix82_En46
  SIGNAL mul_temp_4                       : signed(99 DOWNTO 0);  -- sfix100_En61
  SIGNAL add_cast_3                       : signed(100 DOWNTO 0);  -- sfix101_En61
  SIGNAL add_cast_4                       : signed(100 DOWNTO 0);  -- sfix101_En61
  SIGNAL add_temp_1                       : signed(100 DOWNTO 0);  -- sfix101_En61
  SIGNAL sub_cast_2                       : signed(45 DOWNTO 0);  -- sfix46_En31
  SIGNAL mul_temp_5                       : signed(44 DOWNTO 0);  -- sfix45_En31
  SIGNAL sub_cast_3                       : signed(45 DOWNTO 0);  -- sfix46_En31
  SIGNAL sub_temp_1                       : signed(45 DOWNTO 0);  -- sfix46_En31
  SIGNAL sub_cast_4                       : signed(81 DOWNTO 0);  -- sfix82_En46
  SIGNAL cast_1                           : signed(18 DOWNTO 0);  -- sfix19
  SIGNAL mul_temp_6                       : signed(36 DOWNTO 0);  -- sfix37_En15
  SIGNAL cast_2                           : signed(35 DOWNTO 0);  -- sfix36_En15
  SIGNAL mul_temp_7                       : signed(53 DOWNTO 0);  -- sfix54_En30
  SIGNAL mul_temp_8                       : signed(80 DOWNTO 0);  -- sfix81_En46
  SIGNAL sub_cast_5                       : signed(81 DOWNTO 0);  -- sfix82_En46
  SIGNAL sub_temp_2                       : signed(81 DOWNTO 0);  -- sfix82_En46
  SIGNAL sub_cast_6                       : signed(82 DOWNTO 0);  -- sfix83_En46
  SIGNAL cast_3                           : signed(18 DOWNTO 0);  -- sfix19
  SIGNAL mul_temp_9                       : signed(36 DOWNTO 0);  -- sfix37_En15
  SIGNAL cast_4                           : signed(35 DOWNTO 0);  -- sfix36_En15
  SIGNAL mul_temp_10                      : signed(53 DOWNTO 0);  -- sfix54_En30
  SIGNAL sub_cast_7                       : signed(82 DOWNTO 0);  -- sfix83_En46
  SIGNAL sub_temp_3                       : signed(82 DOWNTO 0);  -- sfix83_En46
  SIGNAL mul_temp_11                      : signed(100 DOWNTO 0);  -- sfix101_En61
  SIGNAL add_cast_5                       : signed(101 DOWNTO 0);  -- sfix102_En61
  SIGNAL add_cast_6                       : signed(101 DOWNTO 0);  -- sfix102_En61
  SIGNAL add_temp_2                       : signed(101 DOWNTO 0);  -- sfix102_En61
  SIGNAL sub_cast_8                       : signed(45 DOWNTO 0);  -- sfix46_En31
  SIGNAL mul_temp_12                      : signed(44 DOWNTO 0);  -- sfix45_En31
  SIGNAL sub_cast_9                       : signed(45 DOWNTO 0);  -- sfix46_En31
  SIGNAL sub_temp_4                       : signed(45 DOWNTO 0);  -- sfix46_En31
  SIGNAL mul_temp_13                      : signed(63 DOWNTO 0);  -- sfix64_En46
  SIGNAL add_cast_7                       : signed(64 DOWNTO 0);  -- sfix65_En46
  SIGNAL add_cast_8                       : signed(64 DOWNTO 0);  -- sfix65_En46
  SIGNAL add_temp_3                       : signed(64 DOWNTO 0);  -- sfix65_En46
  SIGNAL sub_cast_10                      : signed(45 DOWNTO 0);  -- sfix46_En31
  SIGNAL mul_temp_14                      : signed(44 DOWNTO 0);  -- sfix45_En31
  SIGNAL sub_cast_11                      : signed(45 DOWNTO 0);  -- sfix46_En31
  SIGNAL sub_temp_5                       : signed(45 DOWNTO 0);  -- sfix46_En31
  SIGNAL mul_temp_15                      : signed(63 DOWNTO 0);  -- sfix64_En46
  SIGNAL add_cast_9                       : signed(64 DOWNTO 0);  -- sfix65_En46
  SIGNAL add_cast_10                      : signed(64 DOWNTO 0);  -- sfix65_En46
  SIGNAL add_temp_4                       : signed(64 DOWNTO 0);  -- sfix65_En46

BEGIN
  vd_pu_signed <= signed(vd_pu);

  vq_pu_signed <= signed(vq_pu);

  vx_pu_signed <= signed(vx_pu);

  vy_pu_signed <= signed(vy_pu);

  id_k_pu_signed <= signed(id_k_pu);

  iq_k_pu_signed <= signed(iq_k_pu);

  ix_k_pu_signed <= signed(ix_k_pu);

  iy_k_pu_signed <= signed(iy_k_pu);

  omega_m_pu_signed <= signed(omega_m_pu);

  Ts_times_ZB_over_Ld_signed <= signed(Ts_times_ZB_over_Ld);

  Ts_times_ZB_over_Lq_signed <= signed(Ts_times_ZB_over_Lq);

  Ts_times_ZB_over_Lx_signed <= signed(Ts_times_ZB_over_Lx);

  Ts_times_ZB_over_Ly_signed <= signed(Ts_times_ZB_over_Ly);

  Rs_over_ZB_signed <= signed(Rs_over_ZB);

  Ld_over_LB_signed <= signed(Ld_over_LB);

  Lq_over_LB_signed <= signed(Lq_over_LB);

  psi_pm_over_psiB_signed <= signed(psi_pm_over_psiB);

  polepairs_unsigned <= unsigned(polepairs);

  --MATLAB Function 'delay_comp/delay_compensation'
  ix_k_pu_1 <= resize(ix_k_pu_signed & '0' & '0' & '0' & '0' & '0', 27);
  iy_k_pu_1 <= resize(iy_k_pu_signed & '0' & '0' & '0' & '0' & '0', 27);
  polepairs_1 <= polepairs_unsigned(17 DOWNTO 0);
  --Prediction d-current
  --Prediction q-current
  --Prediction x-current
  --Prediction y-current
  sub_cast <= resize(vd_pu_signed & '0' & '0' & '0' & '0' & '0' & '0' & '0', 46);
  mul_temp <= Rs_over_ZB_signed * id_k_pu_signed;
  sub_cast_1 <= resize(mul_temp, 46);
  sub_temp <= sub_cast - sub_cast_1;
  add_cast <= resize(sub_temp & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0', 82);
  mul_temp_1 <= iq_k_pu_signed * Lq_over_LB_signed;
  mul_temp_2 <= mul_temp_1 * omega_m_pu_signed;
  cast <= signed(resize(polepairs_1, 19));
  mul_temp_3 <= mul_temp_2 * cast;
  add_cast_1 <= mul_temp_3(80 DOWNTO 0);
  add_cast_2 <= resize(add_cast_1, 82);
  add_temp <= add_cast + add_cast_2;
  mul_temp_4 <= Ts_times_ZB_over_Ld_signed * add_temp;
  add_cast_3 <= resize(mul_temp_4, 101);
  add_cast_4 <= resize(id_k_pu_signed & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0', 101);
  add_temp_1 <= add_cast_3 + add_cast_4;
  id_delay_pu_tmp <= add_temp_1(63 DOWNTO 37);
  sub_cast_2 <= resize(vq_pu_signed & '0' & '0' & '0' & '0' & '0' & '0' & '0', 46);
  mul_temp_5 <= Rs_over_ZB_signed * iq_k_pu_signed;
  sub_cast_3 <= resize(mul_temp_5, 46);
  sub_temp_1 <= sub_cast_2 - sub_cast_3;
  sub_cast_4 <= resize(sub_temp_1 & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0', 82);
  cast_1 <= signed(resize(polepairs_1, 19));
  mul_temp_6 <= omega_m_pu_signed * cast_1;
  cast_2 <= mul_temp_6(35 DOWNTO 0);
  mul_temp_7 <= cast_2 * Ld_over_LB_signed;
  mul_temp_8 <= mul_temp_7 * id_k_pu_signed;
  sub_cast_5 <= resize(mul_temp_8, 82);
  sub_temp_2 <= sub_cast_4 - sub_cast_5;
  sub_cast_6 <= resize(sub_temp_2, 83);
  cast_3 <= signed(resize(polepairs_1, 19));
  mul_temp_9 <= omega_m_pu_signed * cast_3;
  cast_4 <= mul_temp_9(35 DOWNTO 0);
  mul_temp_10 <= cast_4 * psi_pm_over_psiB_signed;
  sub_cast_7 <= resize(mul_temp_10 & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0', 83);
  sub_temp_3 <= sub_cast_6 - sub_cast_7;
  mul_temp_11 <= Ts_times_ZB_over_Lq_signed * sub_temp_3;
  add_cast_5 <= resize(mul_temp_11, 102);
  add_cast_6 <= resize(iq_k_pu_signed & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0', 102);
  add_temp_2 <= add_cast_5 + add_cast_6;
  iq_delay_pu_tmp <= add_temp_2(63 DOWNTO 37);
  sub_cast_8 <= resize(vx_pu_signed & '0' & '0' & '0' & '0' & '0' & '0' & '0', 46);
  mul_temp_12 <= Rs_over_ZB_signed * ix_k_pu_1;
  sub_cast_9 <= resize(mul_temp_12, 46);
  sub_temp_4 <= sub_cast_8 - sub_cast_9;
  mul_temp_13 <= Ts_times_ZB_over_Lx_signed * sub_temp_4;
  add_cast_7 <= resize(mul_temp_13, 65);
  add_cast_8 <= resize(ix_k_pu_1 & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0', 65);
  add_temp_3 <= add_cast_7 + add_cast_8;
  ix_delay_pu_tmp <= add_temp_3(48 DOWNTO 22);
  sub_cast_10 <= resize(vy_pu_signed & '0' & '0' & '0' & '0' & '0' & '0' & '0', 46);
  mul_temp_14 <= Rs_over_ZB_signed * iy_k_pu_1;
  sub_cast_11 <= resize(mul_temp_14, 46);
  sub_temp_5 <= sub_cast_10 - sub_cast_11;
  mul_temp_15 <= Ts_times_ZB_over_Ly_signed * sub_temp_5;
  add_cast_9 <= resize(mul_temp_15, 65);
  add_cast_10 <= resize(iy_k_pu_1 & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0', 65);
  add_temp_4 <= add_cast_9 + add_cast_10;
  iy_delay_pu_tmp <= add_temp_4(48 DOWNTO 22);

  id_delay_pu <= std_logic_vector(id_delay_pu_tmp);

  iq_delay_pu <= std_logic_vector(iq_delay_pu_tmp);

  ix_delay_pu <= std_logic_vector(ix_delay_pu_tmp);

  iy_delay_pu <= std_logic_vector(iy_delay_pu_tmp);

END rtl;

