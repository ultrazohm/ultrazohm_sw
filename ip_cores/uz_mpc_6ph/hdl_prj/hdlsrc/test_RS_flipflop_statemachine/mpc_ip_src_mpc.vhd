-- -------------------------------------------------------------
-- 
-- File Name: hdl_prj\hdlsrc\test_RS_flipflop_statemachine\mpc_ip_src_mpc.vhd
-- Created: 2022-08-29 16:54:27
-- 
-- Generated by MATLAB 9.10 and HDL Coder 3.18
-- 
-- 
-- -------------------------------------------------------------
-- Rate and Clocking Details
-- -------------------------------------------------------------
-- Model base rate: 1e-08
-- Target subsystem base rate: 1e-08
-- 
-- 
-- Clock Enable  Sample Time
-- -------------------------------------------------------------
-- ce_out        1e-08
-- -------------------------------------------------------------
-- 
-- 
-- Output Signal                 Clock Enable  Sample Time
-- -------------------------------------------------------------
-- Out1                          ce_out        1e-08
-- -------------------------------------------------------------
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: mpc_ip_src_mpc
-- Source Path: test_RS_flipflop_statemachine/mpc
-- Hierarchy Level: 0
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;

ENTITY mpc_ip_src_mpc IS
  PORT( clk                               :   IN    std_logic;
        reset                             :   IN    std_logic;
        clk_enable                        :   IN    std_logic;
        In1                               :   IN    std_logic;
        i_measure                         :   IN    std_logic_vector(17 DOWNTO 0);  -- sfix18_En15
        ce_out                            :   OUT   std_logic;
        Out1                              :   OUT   std_logic
        );
END mpc_ip_src_mpc;


ARCHITECTURE rtl OF mpc_ip_src_mpc IS

  -- Component Declarations
  COMPONENT mpc_ip_src_delay_comp
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb                             :   IN    std_logic;
          trigger                         :   IN    std_logic;
          adc_trigger                     :   IN    std_logic;
          done                            :   OUT   std_logic
          );
  END COMPONENT;

  COMPONENT mpc_ip_src_vsd_dq_voltages
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb                             :   IN    std_logic;
          adc_trigger                     :   IN    std_logic;
          delay_comp_done                 :   IN    std_logic;
          prediction_done                 :   IN    std_logic;
          done                            :   OUT   std_logic
          );
  END COMPONENT;

  COMPONENT mpc_ip_src_predict
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb                             :   IN    std_logic;
          voltages_done                   :   IN    std_logic;
          adc_trigger                     :   IN    std_logic;
          done                            :   OUT   std_logic;
          last_prediciton_done            :   OUT   std_logic
          );
  END COMPONENT;

  COMPONENT mpc_ip_src_cost_and_optim
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb                             :   IN    std_logic;
          trigger                         :   IN    std_logic;
          done                            :   OUT   std_logic
          );
  END COMPONENT;

  -- Component Configuration Statements
  FOR ALL : mpc_ip_src_delay_comp
    USE ENTITY work.mpc_ip_src_delay_comp(rtl);

  FOR ALL : mpc_ip_src_vsd_dq_voltages
    USE ENTITY work.mpc_ip_src_vsd_dq_voltages(rtl);

  FOR ALL : mpc_ip_src_predict
    USE ENTITY work.mpc_ip_src_predict(rtl);

  FOR ALL : mpc_ip_src_cost_and_optim
    USE ENTITY work.mpc_ip_src_cost_and_optim(rtl);

  -- Signals
  SIGNAL predict_done                     : std_logic;
  SIGNAL predict_done_1                   : std_logic;
  SIGNAL vsd_dq_volt_done                 : std_logic;
  SIGNAL delay_comp_done                  : std_logic;
  SIGNAL delay_comp_done_1                : std_logic;
  SIGNAL predict_done_2                   : std_logic;
  SIGNAL predict_done_3                   : std_logic;
  SIGNAL optimization_done                : std_logic;

BEGIN
  u_delay_comp : mpc_ip_src_delay_comp
    PORT MAP( clk => clk,
              reset => reset,
              enb => clk_enable,
              trigger => vsd_dq_volt_done,
              adc_trigger => In1,
              done => delay_comp_done
              );

  u_vsd_dq_voltages : mpc_ip_src_vsd_dq_voltages
    PORT MAP( clk => clk,
              reset => reset,
              enb => clk_enable,
              adc_trigger => In1,
              delay_comp_done => delay_comp_done_1,
              prediction_done => predict_done_1,
              done => vsd_dq_volt_done
              );

  u_predict : mpc_ip_src_predict
    PORT MAP( clk => clk,
              reset => reset,
              enb => clk_enable,
              voltages_done => vsd_dq_volt_done,
              adc_trigger => In1,
              done => predict_done,
              last_prediciton_done => predict_done_2
              );

  u_cost_and_optim : mpc_ip_src_cost_and_optim
    PORT MAP( clk => clk,
              reset => reset,
              enb => clk_enable,
              trigger => predict_done_3,
              done => optimization_done
              );

  predict_done_1 <= predict_done;

  delay_comp_done_1 <= delay_comp_done;

  predict_done_3 <= predict_done_2;

  ce_out <= clk_enable;

  Out1 <= optimization_done;

END rtl;

