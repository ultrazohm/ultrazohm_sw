-- -------------------------------------------------------------
-- 
-- File Name: hdl_prj\hdlsrc\uz_mpc_cost_and_optim_state_machine\uz_6ph_cost_ip_src_iterativesearch.vhd
-- Created: 2022-10-04 14:21:12
-- 
-- Generated by MATLAB 9.10 and HDL Coder 3.18
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: uz_6ph_cost_ip_src_iterativesearch
-- Source Path: uz_mpc_cost_and_optim_state_machine/uz_6ph_mpc_costs_and_optimization/iterativesearch
-- Hierarchy Level: 1
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;

ENTITY uz_6ph_cost_ip_src_iterativesearch IS
  PORT( clk                               :   IN    std_logic;
        reset                             :   IN    std_logic;
        enb                               :   IN    std_logic;
        index                             :   IN    std_logic_vector(31 DOWNTO 0);  -- uint32
        cost                              :   IN    std_logic_vector(26 DOWNTO 0);  -- ufix27_En24
        opt_idx                           :   OUT   std_logic_vector(31 DOWNTO 0);  -- uint32
        opt_done                          :   OUT   std_logic
        );
END uz_6ph_cost_ip_src_iterativesearch;


ARCHITECTURE rtl OF uz_6ph_cost_ip_src_iterativesearch IS

  -- Signals
  SIGNAL index_unsigned                   : unsigned(31 DOWNTO 0);  -- uint32
  SIGNAL cost_unsigned                    : unsigned(26 DOWNTO 0);  -- ufix27_En24
  SIGNAL opt_idx_tmp                      : unsigned(31 DOWNTO 0);  -- uint32
  SIGNAL min_costs                        : unsigned(26 DOWNTO 0);  -- ufix27_En24
  SIGNAL cost_old                         : unsigned(26 DOWNTO 0);  -- ufix27
  SIGNAL index_old                        : unsigned(31 DOWNTO 0);  -- uint32
  SIGNAL opt_idx_old                      : unsigned(31 DOWNTO 0);  -- uint32
  SIGNAL cost_old_next                    : unsigned(26 DOWNTO 0);  -- ufix27_En24
  SIGNAL index_old_next                   : unsigned(31 DOWNTO 0);  -- uint32
  SIGNAL opt_idx_old_next                 : unsigned(31 DOWNTO 0);  -- uint32

BEGIN
  index_unsigned <= unsigned(index);

  cost_unsigned <= unsigned(cost);

  iterativesearch_process : PROCESS (clk)
  BEGIN
    IF clk'EVENT AND clk = '1' THEN
      IF reset = '1' THEN
        cost_old <= to_unsigned(16#4FAE148#, 27);
        index_old <= to_unsigned(16#00000001#, 32);
        opt_idx_old <= to_unsigned(16#00000001#, 32);
      ELSIF enb = '1' THEN
        cost_old <= cost_old_next;
        index_old <= index_old_next;
        opt_idx_old <= opt_idx_old_next;
      END IF;
    END IF;
  END PROCESS iterativesearch_process;

  iterativesearch_output : PROCESS (cost_old, cost_unsigned, index_old, index_unsigned, opt_idx_old)
    VARIABLE cost_old_temp : unsigned(26 DOWNTO 0);
    VARIABLE opt_idx_old_temp : unsigned(31 DOWNTO 0);
  BEGIN
    cost_old_temp := cost_old;
    opt_idx_old_temp := opt_idx_old;
    index_old_next <= index_old;
    --MATLAB Function 'uz_6ph_mpc_costs_and_optimization/iterativesearch'
    IF index_unsigned < to_unsigned(16#0000003F#, 32) THEN 
      IF index_unsigned /= index_old THEN 
        IF cost_unsigned <= cost_old THEN 
          opt_idx_old_temp := index_unsigned;
          cost_old_temp := cost_unsigned;
        END IF;
        index_old_next <= index_unsigned;
      END IF;
    ELSE 
      cost_old_temp := to_unsigned(16#4FAE148#, 27);
    END IF;
    IF index_unsigned = to_unsigned(16#0000003F#, 32) THEN 
      opt_done <= '1';
    ELSE 
      opt_done <= '0';
    END IF;
    opt_idx_tmp <= opt_idx_old_temp;
    min_costs <= cost_old_temp;
    cost_old_next <= cost_old_temp;
    opt_idx_old_next <= opt_idx_old_temp;
  END PROCESS iterativesearch_output;


  opt_idx <= std_logic_vector(opt_idx_tmp);

END rtl;

